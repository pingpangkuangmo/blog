#1 系列目录

-	[分布式事务系列（开篇）提出疑问和研究过程](http://my.oschina.net/pingpangkuangmo/blog/413518)
-	[分布式事务系列（1.1）Spring事务管理器PlatformTransactionManager源码分析](http://my.oschina.net/pingpangkuangmo/blog/415162)
-	[分布式事务系列（1.2）Spring事务体系](http://my.oschina.net/pingpangkuangmo/blog/416038)
-	[分布式事务系列（2.1）分布式事务模型与接口定义](http://my.oschina.net/pingpangkuangmo/blog/417479)

#2 jotm的分布式案例

先来感受下一个分布式事务的案例（使用一般的数据库驱动，不需要支持分布式XA协议）：

##2.1 业务逻辑的操作

UserDao和LogDao,操作分别如下：

	@Repository
	public class UserDao {
	
		@Resource(name="jdbcTemplateA")
		private JdbcTemplate jdbcTemplate;
		
		public void save(User user){
			jdbcTemplate.update("insert into user(name,age) values(?,?)",user.getName(),user.getAge());
		}
	}

	@Repository
	public class LogDao {
	
		@Resource(name="jdbcTemplateB")
		private JdbcTemplate jdbcTemplate;
		
		public void save(User user){
			jdbcTemplate.update("insert into log(name,age) values(?,?)",user.getName(),user.getAge());
		}
	}

即上述两个JdbcTemplate使用不同的数据库。

UserService综合上述两个业务操作，使它们处于同一个事务中：

	@Service
	public class UserService {
		
		@Autowired
		private UserDao userDao;
		@Autowired
		private LogDao logDao;
		
		@Transactional
		public void save(User user){
			userDao.save(user);
			logDao.save(user);
			throw new RuntimeException();
		}
	}

##2.2 配置

上述业务代码我们看不到分布式事务的存在，这种正是我们想要的效果。到底是如何来实现呢？

###2.2.1 dataSource和JdbcTemplate配置

	<!-- 配置数据源 -->
     <bean id="dataSourceA" class="org.enhydra.jdbc.pool.StandardXAPoolDataSource"  destroy-method="shutdown">
     	<property name="dataSource">  
            <bean class="org.enhydra.jdbc.standard.StandardXADataSource" destroy-method="shutdown">  
                <property name="transactionManager" ref="jotm" />  
                <property name="driverName" value="com.mysql.jdbc.Driver" />  
                <property name="url" value="jdbc:mysql://localhost:3306/test?useUnicode=true&amp;characterEncoding=utf-8" />  
            </bean>  
        </property>     
        <property name="user" value="root" />  
        <property name="password" value="ligang" />  
    </bean>
 	
 	<!-- 配置数据源 -->
     <bean id="dataSourceB"   class="org.enhydra.jdbc.pool.StandardXAPoolDataSource"  destroy-method="shutdown">   
        <property name="dataSource">  
            <bean class="org.enhydra.jdbc.standard.StandardXADataSource" destroy-method="shutdown">  
                <property name="transactionManager" ref="jotm" />  
                <property name="driverName" value="com.mysql.jdbc.Driver" />  
                <property name="url" value="jdbc:mysql://localhost:3306/test2?useUnicode=true&amp;characterEncoding=utf-8" />  
            </bean>  
        </property>     
        <property name="user" value="root" />  
        <property name="password" value="ligang" /> 
    </bean>

我们平常使用的dataSource，大部分是c3p0、dbcp等，这里就不能使用它们了，需要换成可以模拟XA协议的dataSource，即StandardXAPoolDataSource。这个连接池是xapool的内容。

顺便介绍下xapool[官网地址](http://xapool.ow2.org/):

-	详细去了解下，它的目标是什么？该提供什么功能，不该提供什么功能
-	好久都没更新了，最近一次更新还是06年